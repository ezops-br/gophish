var presets=[],preset={};$(document).ready((function(){$("#presetsTable").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[2,"desc"]]}),$("#new_button").on("click",(function(){edit("new")})),load(),$(".modal").on("hidden.bs.modal",(function(e){$(this).removeClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")-1)})),$(".modal").on("shown.bs.modal",(function(e){void 0===$("body").data("fv_open_modals")&&$("body").data("fv_open_modals",0),$(this).hasClass("fv-modal-stack")||($(this).addClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")+1),$(this).css("z-index",1040+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not(".fv-modal-stack").css("z-index",1039+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not("fv-modal-stack").addClass("fv-modal-stack"))})),$(document).on("hidden.bs.modal",".modal",(function(){$(".modal:visible").length&&$(document.body).addClass("modal-open")})),$("#modal").on("hidden.bs.modal",(function(e){dismiss()}))}));var load=function(){$("#loading").show(),setupOptions(),loadPresets()};function setupOptions(){api.templates.get().success((function(e){if(0==e.length)return $("#emptyMessage").show(),void $("#loading").hide();var t=$.map(e,(function(e){return e.text=e.name,e}));$("#template").select2({placeholder:"Select a Template",data:t})})).error((function(){$("#loading").hide(),errorFlash("Error loading templates")})),api.pages.get().success((function(e){if(0==e.length)return $("#emptyMessage").show(),void $("#loading").hide();var t=$.map(e,(function(e){return e.text=e.name,e}));$("#page").select2({placeholder:"Select a Landing Page",data:t})})).error((function(){$("#loading").hide(),errorFlash("Error loading landing pages")})),api.SMTP.get().success((function(e){if(0==e.length)return $("#emptyMessage").show(),void $("#loading").hide();var t=$.map(e,(function(e){return e.text=e.name,e}));$("#profile").select2({placeholder:"Select a Sending Profile",data:t})})).error((function(){$("#loading").hide(),errorFlash("Error loading sending profiles")}))}var loadPresets=function(){$("#presetsTable").hide(),$("#emptyMessage").hide(),$("#loading").show(),api.presets.get().success((function(e){presets=e,$("#loading").hide(),0==presets.length?$("#emptyMessage").show():(presetsTable=$("#presetsTable").DataTable(),presetsTable.clear(),$.each(presets,(function(e,t){presetsTable.row.add([escapeHtml(t.name),escapeHtml(t.template.name),moment(t.created_date).format("MMMM Do YYYY, h:mm:ss a"),"<div class='pull-right'><button class='btn btn-primary' data-toggle='modal' data-backdrop='static' data-target='#modal' onclick='edit("+t.id+")'><i class='fa fa-pencil'></i></button><button class='btn btn-danger' onclick='deletePreset("+t.id+")'><i class='fa fa-trash-o'></i></button></div>"]).draw()})),$("#presetsTable").show())})).error((function(){$("#loading").hide(),errorFlash("Error loading presets")}))},edit=function(e){if($("#presetModalLabel").text("Edit Preset"),"new"==e)return $("#presetModalLabel").text("New Preset"),$("#name").val(""),$("#url").val(""),$("#template").val("").change(),$("#page").val("").change(),$("#profile").val("").change(),void $("#modal").modal("show");api.presets.get(e).success((function(t){preset=t,$("#name").val(preset.name),$("#url").val(preset.url),preset.template.id&&$("#template").val(preset.template.id.toString()).change(),preset.page.id&&$("#page").val(preset.page.id.toString()).change(),preset.smtp.id&&$("#profile").val(preset.smtp.id.toString()).change(),window.editId=e,$("#modal").modal("show")})).error((function(){errorFlash("Error loading preset")}))},deletePreset=function(e){Swal.fire({title:"Are you sure?",text:"This will delete the preset. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete Preset",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise((function(t,a){api.presets.delete(e).success((function(e){t()})).error((function(e){a(e.responseJSON.message)}))}))}}).then((function(e){e.value&&Swal.fire("Preset Deleted!","The preset has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))},dismiss=function(){$("#modal\\.flashes").empty(),$("#name").val(""),$("#url").val(""),$("#template").val("").change(),$("#page").val("").change(),$("#profile").val("").change(),$("#modal").modal("hide")},save=function(){Swal.fire({title:"Are you sure?",text:"This will save the campaign preset.",type:"question",animation:!1,showCancelButton:!0,confirmButtonText:"Save",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise((function(e,t){var a=$("#template").select2("data"),s=$("#page").select2("data"),o=$("#profile").select2("data");preset={name:$("#name").val(),template:{name:a[0].text},url:$("#url").val(),page:{name:s[0].text},smtp:{name:o[0].text}},window.editId?(preset.id=window.editId,api.presets.put(preset).success((function(t){e(),preset=t})).error((function(e){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">                            <i class="fa fa-exclamation-circle"></i> '+e.responseJSON.message+"</div>"),Swal.close()}))):api.presets.post(preset).success((function(t){e(),preset=t})).error((function(e){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">                            <i class="fa fa-exclamation-circle"></i> '+e.responseJSON.message+"</div>"),Swal.close()}))}))}}).then((function(e){e.value&&Swal.fire("Preset Saved!","This preset has been saved!","success"),$('button:contains("OK")').on("click",(function(){dismiss(),load()}))}))};